const app = new Vue({
  el: "#app",
  data: {
    tempAudio: null,
    tempValues: {
      duration: 0,
      actual: 0,
    },
    progress: {
      percentage: 33,
      file: "childStuff.js",
    },
    player: {
      volume: 50,
      name: "Frozeine - Distorted (Official Audio).mp3",
    },
    allPlayers: [
      // "YakariKetamin.mp3",
      "SummertimeSadness.mp3"
    ],
    socialMedia: [
      {
        label: 'Unser Teamspeak',
        link: 'limitlessrp.de',
        // icon: 'teamspeak',
      },
      {
        label: 'Unser Shop',
        link: 'limitless-rp.tebex.io',
        // icon: 'tebex',
      },
      {
        label: 'Unser Discord',
        link: 'discord.gg/limitlessrp',
        // icon: 'discord',
      },
      {
        label: 'Unser Regelwerk',
        link: 'regelwerk.limitlessrp.de',
        // icon: 'regelwerk',
      },
    ],
    icons: {
      instagram: `<svg width="29" height="35" viewBox="0 0 29 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M10.7651 5.04173C8.68982 5.13844 6.18905 5.364 5.64548 5.50344C4.05398 5.91178 2.78728 7.24815 2.4635 8.86046C2.33143 9.51813 2.14071 11.8144 2.04474 13.903C1.98454 15.2122 1.98524 18.7988 2.04595 20.1177C2.15125 22.4063 2.36129 24.7752 2.51066 25.3596C2.89516 26.8636 4.13916 28.1074 5.64548 28.4939C6.03954 28.5949 7.75346 28.771 9.52266 28.892C11.0256 28.9949 15.3953 29.0362 17.0031 28.9628C19.441 28.8514 21.7461 28.6493 22.3552 28.4934C23.8558 28.1095 25.1059 26.8595 25.4894 25.3596C25.6388 24.7752 25.8488 22.4063 25.9541 20.1177C26.0153 18.7887 26.0153 15.2086 25.9541 13.8796C25.8488 11.591 25.6388 9.22208 25.4894 8.63776C25.1044 7.13197 23.8617 5.88932 22.3552 5.50386C21.7622 5.35213 19.4453 5.1467 17.1178 5.03952C15.9508 4.98577 11.9358 4.98718 10.7651 5.04173ZM17.9383 9.6019C18.8673 9.83084 19.5441 10.2027 20.1686 10.8275C20.8158 11.4749 21.2038 12.2053 21.4164 13.176C21.4642 13.3946 21.478 14.2475 21.478 16.9987C21.478 20.7335 21.4789 20.7135 21.2574 21.4076C20.8355 22.7293 19.7282 23.837 18.4071 24.2591C17.7134 24.4807 17.7333 24.4797 14 24.4797C10.2668 24.4797 10.2867 24.4807 9.59298 24.2591C8.27185 23.837 7.16456 22.7293 6.74265 21.4076C6.52113 20.7135 6.52211 20.7335 6.52211 16.9987C6.52211 13.2638 6.52113 13.2838 6.74265 12.5897C7.2308 11.0605 8.59661 9.86831 10.179 9.59032C10.6481 9.50791 10.7218 9.50655 14.2345 9.51687C17.1696 9.52545 17.6751 9.53708 17.9383 9.6019ZM10.2194 11.0872C9.13671 11.3735 8.30837 12.2314 8.06857 13.3147C8.00518 13.6009 7.99721 14.1119 8.00888 17.1394C8.02229 20.6105 8.02309 20.6357 8.12665 20.9385C8.44007 21.8553 9.18167 22.5884 10.0853 22.8748C10.4123 22.9785 10.4259 22.9788 14 22.9788C17.5742 22.9788 17.5877 22.9785 17.9148 22.8748C18.8358 22.5829 19.5819 21.8365 19.8737 20.9151C19.9773 20.5879 19.9777 20.5743 19.9777 16.9987C19.9777 13.423 19.9773 13.4094 19.8737 13.0822C19.585 12.1706 18.8624 11.439 17.9383 11.1228C17.635 11.0189 17.6168 11.0184 14.0938 11.0086C10.7564 10.9993 10.535 11.0038 10.2194 11.0872ZM18.3684 12.3185C19.0083 12.6784 18.9628 13.6506 18.2918 13.9556C17.8563 14.1535 17.3702 14.0058 17.1184 13.5991C16.613 12.7828 17.5276 11.8459 18.3684 12.3185ZM15.008 13.2689C15.4326 13.3853 16.0963 13.7288 16.4368 14.0082C17.8059 15.1317 18.2368 17.0807 17.4679 18.6719C16.536 20.6005 14.2056 21.3982 12.2888 20.4448C11.5111 20.058 10.8639 19.3995 10.5126 18.6376C10.2734 18.1188 10.1982 17.7896 10.1704 17.1394C10.1392 16.4131 10.2417 15.9182 10.5542 15.2867C10.9386 14.5097 11.5129 13.9346 12.2865 13.552C12.9328 13.2324 13.3273 13.1496 14.0938 13.1726C14.478 13.1842 14.8373 13.222 15.008 13.2689ZM13.4203 14.681C12.3859 14.9315 11.6104 15.9246 11.6104 16.9987C11.6104 18.2976 12.7016 19.3893 14 19.3893C15.0854 19.3893 16.0706 18.611 16.3189 17.5571C16.7295 15.8143 15.1622 14.2592 13.4203 14.681Z" fill="url(#paint0_radial_1_2)"/>
      <defs>
      <radialGradient id="paint0_radial_1_2" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14 17) rotate(66.8937) scale(19.5699 21.2653)">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.63"/>
      </radialGradient>
      </defs>
      </svg>
      `,
      youtube: `<svg width="29" height="35" viewBox="0 0 29 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M6.54402 7.04661C4.50353 7.12644 3.29353 7.36669 2.21114 7.90696C0.916207 8.55326 0.313756 9.56121 0.0834565 11.4666C0.016782 12.0184 0 13.0191 0 16.4461C0 19.0685 0.0234721 20.9696 0.0604379 21.3389C0.398686 24.7176 1.79505 26.23 5.08546 26.7812C6.1569 26.9607 7.87825 27.0004 14.5709 27C21.0983 26.9996 22.9867 26.9611 24.046 26.8072C25.4782 26.599 26.5305 26.18 27.2669 25.5246C28.1505 24.738 28.6077 23.7498 28.8993 21.9957C28.9902 21.4488 29 20.925 29 16.6081C29 12.2861 28.9902 11.7663 28.8987 11.2036C28.5668 9.16324 27.6893 8.07563 25.9384 7.53447C24.9913 7.24176 24.0533 7.11527 22.3 7.04401C20.8213 6.98387 8.09341 6.98597 6.54402 7.04661ZM15.4213 14.4489C19.12 16.3233 18.8093 16.1508 18.9704 16.4189C19.2629 16.9057 19.0924 17.3683 18.4972 17.7026C17.645 18.1812 12.432 20.7998 12.2607 20.8353C12.0387 20.8814 11.701 20.7848 11.5181 20.623C11.2182 20.3578 11.2258 20.4552 11.2258 16.8818C11.2258 13.1457 11.2091 13.2989 11.6437 13.0388C12.0999 12.7658 12.1006 12.7661 15.4213 14.4489Z" fill="url(#paint0_radial_1_3)"/>
      <defs>
      <radialGradient id="paint0_radial_1_3" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14.5 17) rotate(58.2563) scale(17.6385 23.7576)">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.63"/>
      </radialGradient>
      </defs>
      </svg>
      `,
      tebex: `<svg width="29" height="35" viewBox="0 0 29 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M14.2459 1.00129C13.8653 2.2584 12.2528 4.05663 11.0083 4.61213L10.06 5.03542L11.0371 5.51368C12.1323 6.05016 13.8616 7.69461 13.6637 8.01168C13.5927 8.1251 12.0646 8.21787 10.2674 8.21787H7L7.00352 12.3348C7.00727 16.6315 7.01219 16.6447 7.95133 14.8862L8.41586 14.0164H10.0516H11.6875V21.6159V29.2154L14.6172 32.1077L17.5469 35V25.9219V16.8437L16.5461 16.2632C15.4797 15.6448 13.0937 13.4419 13.0937 13.0759C13.0937 12.775 13.1645 12.7855 15.553 13.4393C17.0978 13.8624 18.2402 14.0164 19.8304 14.0164H22V11.1171V8.21787H18.7187C16.6874 8.21787 15.4375 8.1295 15.4375 7.98593C15.4375 7.56426 17.1977 6.00308 18.2601 5.48283C18.8345 5.20126 19.1451 4.97094 18.9501 4.97094C18.7548 4.97071 18.0548 4.61051 17.3941 4.17028C16.1566 3.3455 15.3414 2.28067 14.8377 0.831042L14.5492 0L14.2459 1.00129Z" fill="url(#paint0_radial_1_4)"/>
      <defs>
      <radialGradient id="paint0_radial_1_4" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14.5 17.5) rotate(79.6375) scale(26.6852 14.2143)">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.63"/>
      </radialGradient>
      </defs>
      </svg>
      `,
      teamspeak: `<svg width="29" height="35" viewBox="0 0 29 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M13.4592 4.01162C12.8776 4.03276 12.818 4.03899 12.1091 4.15274C9.98042 4.49426 8.02279 5.41664 6.33536 6.87312C5.98323 7.17705 5.24455 7.92711 5.19054 8.03553C5.1675 8.08185 5.14863 8.19282 5.14863 8.28219C5.14863 8.42221 5.17575 8.49796 5.3449 8.8301C5.45741 9.05108 5.53185 9.23181 5.51928 9.25367C5.50725 9.27461 5.42792 9.38294 5.34298 9.49438C4.81495 10.1873 4.21764 11.2562 3.87901 12.1143C3.47875 13.1285 3.18332 14.3788 3.10598 15.3856C3.05587 16.0376 3.07742 15.9781 2.84661 16.1021C2.43825 16.3215 2.10019 16.8116 2.02915 17.2874C1.99035 17.547 1.99026 19.6649 2.029 19.9526C2.10445 20.5127 2.50645 21.0272 3.04534 21.2534C3.20915 21.3221 3.2457 21.3242 4.45859 21.3336C5.14338 21.339 5.74783 21.3348 5.8018 21.3244C5.92403 21.3008 6.10446 21.1397 6.15817 21.0061C6.19102 20.9244 6.1987 20.4516 6.1987 18.5118C6.1987 16.3426 6.20416 16.0686 6.25711 15.5873C6.34979 14.7451 6.4926 14.1445 6.77204 13.422C7.14838 12.4491 7.67399 11.6164 8.40259 10.8388C9.28491 9.89715 10.2368 9.25304 11.389 8.81807C12.3079 8.47119 13.5327 8.29092 14.4545 8.36688C15.0514 8.41604 15.4305 8.47627 15.8743 8.59238C17.1879 8.93596 18.3502 9.608 19.321 10.5851C20.6663 11.9391 21.4362 13.509 21.7291 15.495C21.8069 16.0225 21.8073 16.0361 21.826 18.5211L21.8447 21.0174L21.9256 21.1274C22.0824 21.341 22.0739 21.3398 23.4394 21.3394C24.7676 21.339 24.8257 21.333 25.156 21.1629C25.3632 21.0563 25.7156 20.6977 25.827 20.4802C25.992 20.158 26 20.072 26 18.6278C26 17.1835 25.992 17.0975 25.827 16.7754C25.7083 16.5436 25.362 16.1943 25.1422 16.0848L24.9596 15.9937L24.9382 15.6353C24.912 15.195 24.8791 14.9317 24.7822 14.3884C24.467 12.6203 23.7675 10.9831 22.7188 9.55859L22.4792 9.23315L22.6797 8.82605C22.9881 8.1999 22.9703 8.12278 22.3802 7.52964C20.5574 5.69741 18.3861 4.5619 15.9193 4.15078C15.1215 4.01783 14.4041 3.97724 13.4592 4.01162ZM8.90551 18.1142C8.38629 18.2313 7.987 18.6901 7.81545 19.3667C7.76714 19.5571 7.75385 19.7051 7.75397 20.051C7.75433 21.0723 8.03434 21.8027 8.62226 22.3155C8.986 22.6328 9.58262 22.8598 10.2414 22.9314C10.7087 22.9823 12.1797 22.9534 12.4486 22.8881C12.8971 22.7791 13.2505 22.5308 13.4002 22.2194C13.5029 22.0056 13.5174 21.6342 13.434 21.35C13.1945 20.534 11.8239 19.1095 10.699 18.5073C10.2769 18.2813 9.99323 18.174 9.65736 18.1131C9.34897 18.0572 9.15651 18.0575 8.90551 18.1142ZM18.378 19.2059C17.8915 19.2975 17.2241 19.6019 16.676 19.9823C15.9779 20.4666 15.3899 21.0336 15.1788 21.4258C15.0816 21.6064 15.0663 21.6637 15.0549 21.8905C15.0431 22.123 15.0499 22.1665 15.1217 22.3191C15.219 22.5256 15.3638 22.6627 15.6034 22.7752C15.9359 22.9312 16.0622 22.9451 17.1494 22.9451C18.2334 22.9451 18.3847 22.93 18.8651 22.7735C19.7247 22.4935 20.217 21.8269 20.2618 20.8823C20.2886 20.3173 20.1812 19.9401 19.8995 19.6097C19.5609 19.2127 19.0552 19.0785 18.378 19.2059ZM21.7699 22.4492C21.6054 22.5234 21.532 22.6136 21.405 22.8983C21.1318 23.5102 20.5355 24.512 20.1061 25.0804C19.2767 26.178 18.4235 26.9244 17.3451 27.4957C16.1492 28.1293 14.8808 28.5183 13.5342 28.6646C13.3527 28.6844 13.1004 28.712 12.9735 28.7261C12.7003 28.7564 12.5926 28.8231 12.5017 29.0181C12.433 29.1655 12.4217 29.3301 12.4709 29.4658C12.5153 29.588 12.672 29.7491 12.782 29.7855C12.9408 29.8382 13.7215 29.9378 14.281 29.9768C14.94 30.0227 16.5348 29.9968 17.0294 29.9321C19.3599 29.6275 20.8926 28.8932 21.918 27.5897C22.3491 27.0418 22.679 26.3101 22.8078 25.6166C22.9214 25.0048 22.8899 24.1826 22.7278 23.5294C22.4942 22.5882 22.1994 22.2557 21.7699 22.4492Z" fill="url(#paint0_radial_1_173)"/>
      <defs>
      <radialGradient id="paint0_radial_1_173" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14 17) rotate(68.5032) scale(20.9579 21.5117)">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.63"/>
      </radialGradient>
      </defs>
      </svg>
      `,
      discord: `<svg width="29" height="35" viewBox="0 0 29 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M10.8877 8.03162C9.69826 8.30812 9.2634 8.42646 8.54881 8.66812C8.07877 8.82712 7.43277 9.06892 7.11324 9.20554C6.43958 9.49349 6.48753 9.44272 5.83195 10.5617C4.63594 12.6031 3.78137 14.8241 3.35704 16.994C3.1123 18.2454 3.03062 19.0693 3.00633 20.5308C2.98047 22.0883 3.03422 22.9738 3.16075 23.074C3.41047 23.2718 4.57144 24.0438 4.99542 24.2939C5.60656 24.6545 6.68332 25.1912 7.31187 25.4486C7.89665 25.6881 8.78891 26 8.8893 26C9.01866 26 10.1807 24.1003 10.1358 23.9622C10.1268 23.9344 9.87737 23.8041 9.58149 23.6726C9.28566 23.5411 8.86285 23.3322 8.64196 23.2085L8.24038 22.9835L8.43955 22.8073C8.54912 22.7103 8.66157 22.631 8.68941 22.6309C8.71725 22.6308 8.85894 22.6852 9.00427 22.7518C10.8732 23.6078 13.1343 24.033 15.2137 23.9196C16.7634 23.835 18.1011 23.531 19.5769 22.9281C19.9771 22.7646 20.3212 22.6311 20.3416 22.6315C20.4214 22.6329 20.7291 22.9406 20.6996 22.9895C20.6522 23.0683 19.8951 23.4717 19.3724 23.6968C19.1159 23.8072 18.8969 23.922 18.8858 23.9518C18.8245 24.1157 19.9721 26 20.1333 26C20.263 26 21.3581 25.5971 22.0427 25.2975C23.3228 24.7374 24.4338 24.094 25.7431 23.1546C25.9154 23.031 25.9287 23.005 25.9636 22.7231C25.9842 22.5581 26.0005 21.7169 26 20.8538C25.9993 19.6296 25.9814 19.1375 25.9185 18.6154C25.5734 15.7501 24.6838 13.115 23.2187 10.6178C22.5507 9.47946 22.5678 9.49898 22.0359 9.26665C20.9497 8.79218 19.5718 8.34509 18.4918 8.11682C17.6746 7.94406 17.7633 7.90534 17.4401 8.57549C17.2874 8.89206 17.1624 9.17245 17.1624 9.19857C17.1624 9.25663 17.1955 9.25825 16.6226 9.17286C15.8543 9.0584 13.748 9.03343 12.8444 9.12809C12.4362 9.17083 12.0578 9.21685 12.0037 9.23032C11.9157 9.25215 11.8726 9.18777 11.6005 8.62737L11.2958 8L11.1368 8.00535C11.0493 8.00831 10.9372 8.02012 10.8877 8.03162ZM11.0542 15.5746C12.2025 15.8227 12.9528 17.1103 12.6917 18.3846C12.3204 20.1963 10.4497 20.8713 9.29875 19.6088C8.84581 19.112 8.65347 18.5925 8.65379 17.867C8.65428 16.7712 9.2925 15.8576 10.2403 15.5961C10.5399 15.5134 10.746 15.508 11.0542 15.5746ZM18.7007 15.5745C19.5116 15.7495 20.1464 16.4385 20.333 17.3462C20.4164 17.7519 20.4169 18.0457 20.3351 18.4421C20.092 19.619 19.086 20.4131 18.0682 20.2313C17.0351 20.0466 16.3069 19.0882 16.3083 17.915C16.3092 17.1882 16.4959 16.6841 16.9474 16.1888C17.4316 15.6577 18.0622 15.4367 18.7007 15.5745Z" fill="url(#paint0_radial_1_174)"/>
      <defs>
      <radialGradient id="paint0_radial_1_174" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14.5 17) rotate(61.4014) scale(15.3759 19.4534)">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.63"/>
      </radialGradient>
      </defs>
      </svg>
      `,
    },
    bars: [
      { percentage: 0, height: '10%' },
      { percentage: 5, height: '20%' },
      { percentage: 10, height: '30%' },
      { percentage: 15, height: '40%' },
      { percentage: 20, height: '50%' },
      { percentage: 25, height: '60%' },
      { percentage: 30, height: '70%' },
      { percentage: 35, height: '80%' },
      { percentage: 40, height: '90%' },
      { percentage: 45, height: '100%' },
      { percentage: 50, height: '10%' },
      { percentage: 55, height: '20%' },
      { percentage: 60, height: '30%' },
      { percentage: 65, height: '40%' },
      { percentage: 70, height: '50%' },
      { percentage: 75, height: '60%' },
      { percentage: 80, height: '70%' },
      { percentage: 85, height: '80%' },
      { percentage: 90, height: '90%' },
      { percentage: 95, height: '100%' },
      { percentage: 100, height: '100%' },
    ],
    audioContext: null,
    source: null,
    analyser: null,
    bufferLength: null,
    dataArray: null,
    animationFrameId: null,
  },
  computed: {
    getAudioLength() {
      if (this.tempAudio) {
        return {
          current: this.tempAudio.currentTime,
          full: this.tempAudio.duration,
        };
      }
      return {
        current: "0",
        full: null,
      };
    },
  },
  methods: {
    requestBrowser(link) {
      if (!link.includes("https://")) link = "https://" + link;
      window.invokeNative('openUrl', link);
    },
    playAudio() {
      this.tempAudio.play();
      this.animate()
    },
    animate() {
      this.analyser.getByteFrequencyData(this.dataArray);

      for (let i = 0; i < this.bars.length; i++) {
        const barHeight = this.dataArray[i] * 2;
        const barPercentage = barHeight / 100;
        this.bars[i].height = `${this.clampPercentage(this.bars[i].percentage * barPercentage, 0, 100)}%`;
      }
      this.animationFrameId = window.requestAnimationFrame(this.animate);
    },
    stopAudio() {
      this.tempAudio.pause();
    },
    toggleSound() {
      if (this.tempAudio) {
        if (this.tempAudio.paused) {
          this.tempAudio.play();
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          this.source = this.audioContext.createMediaElementSource(this.tempAudio);
          this.analyser = this.audioContext.createAnalyser();
          this.bufferLength = this.analyser.frequencyBinCount;
          this.dataArray = new Uint8Array(this.bufferLength);
          this.source.connect(this.analyser);
          this.analyser.connect(this.audioContext.destination);
          this.animate()
        } else {
          this.tempAudio.pause();
        }
      } else {
        this.playAudio();
      }
    },
    secondsToMinutes(time) {
      let minutes = Math.floor(time / 60);
      let seconds = Math.floor(time % 60);
      seconds = seconds < 10 ? "0" + seconds : seconds;
      return `${minutes}:${seconds}`;
    },
    clampPercentage(value, min, max) {
      return Math.max(Math.min((value - min) / (max - min) * 100, 100), 0);
    },
    changeMusic(direction) {
      this.stopAudio();
      let index = this.allPlayers.indexOf(this.player.name);
      if (direction === "next") {
        index = index + 1;
        if (index >= this.allPlayers.length) {
          index = 0;
        }
      } else {
        index = index - 1;
        if (index < 0) {
          index = this.allPlayers.length - 1;
        }
      }
      this.player.name = this.allPlayers[index];
      this.tempAudio.src = "./assets/music/" + this.player.name;
      this.playAudio();
    },
    muteToggle() {
      if (this.player.volume > 0) {
        this.player.volume = 0;
      } else {
        this.player.volume = 50;
      }
    },
    changeLoading(percentage) {
      this.progress.percentage = percentage;
    },
    changeDownloadFile(fileName) {
      this.progress.file = fileName;
    },
    getIcon(icon_name) {
      return this.icons[icon_name];
    }
  },
  mounted() {
    const that = this;
    setInterval(() => {
      this.tempValues.actual = this.tempAudio?.currentTime;
      this.tempValues.duration = this.tempAudio?.duration;
    }, 1000);
    this.player.name = this.allPlayers[0];
    this.tempAudio = new Audio('./assets/music/' + this.player.name);
    window.addEventListener("message", function (e) {
      let data = e.data;
      if (data.eventName == "loadProgress") {
        that.changeLoading(parseInt(data.loadFraction * 100));
      } else if (data.eventName == "onDataFileEntry") {
        that.changeDownloadFile(data.name);
      }
    });

    this.playAudio();
  },
  watch: {
    "player.volume": function (newVal, oldVal) {
      if (this.tempAudio) {
        this.tempAudio.volume = newVal / 100;
      }
    },
  },
});